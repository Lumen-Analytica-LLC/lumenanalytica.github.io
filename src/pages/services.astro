---
import { getCollection } from 'astro:content';
import ContactCTA from '../components/ContactCTA.astro';
import Grid from '../components/Grid.astro';
import Hero from '../components/Hero.astro';
import PortfolioPreview from '../components/PortfolioPreview.astro';
import BaseLayout from '../layouts/BaseLayout.astro';

// Fetch and sort services by order field instead of date
const projects = (await getCollection('services')).sort(
    (a, b) => (a.data.order || 999) - (b.data.order || 999)
);

// Group services by category
const servicesByCategory = projects.reduce((acc, project) => {
    const category = project.data.category || 'Other Services';
    if (!acc[category]) acc[category] = [];
    acc[category].push(project);
    return acc;
}, {} as Record<string, typeof projects>);

const categoryOrder = ['Technical Services', 'Business Services', 'Governance & Compliance'];
---

<BaseLayout
    title="Our Services | Lumen Analytica"
    description="Lumen Analytica provides data engineering, analytics, warehousing, optimization, and compliance services for small to mid-sized institutions seeking enterprise-grade solutions."
>
    <div class="stack gap-20">
        <main class="wrapper stack gap-8">
            <Hero
                title="Our Services"
                tagline="We provide end-to-end data engineering, analytics, and optimization solutions â€” from data warehousing and automation to complex modeling and simulation â€” geared especially toward small to mid-sized institutions that lack in-house engineering or analytics teams."
                align="start"
            />
            
            <!-- Service Overview Section -->
            <section class="service-overview">
                <h2>How We Work</h2>
                <p>
                    Our approach combines technical expertise with business acumen. We don't just build systemsâ€”we partner with you to understand your challenges, design scalable solutions, and deliver measurable results. Whether you need to centralize data, automate workflows, optimize operations, or ensure compliance, we bring enterprise-grade capabilities tailored to your organization's size and needs.
                </p>
                <div class="value-props">
                    <div class="value-prop">
                        <h3>ðŸŽ¯ Results-Focused</h3>
                        <p>Save 20+ hours per week through automation and improved data access</p>
                    </div>
                    <div class="value-prop">
                        <h3>ðŸ”’ Security-First</h3>
                        <p>Compliance built in from day one (HIPAA, GDPR, SOC 2)</p>
                    </div>
                    <div class="value-prop">
                        <h3>âš¡ Fast Implementation</h3>
                        <p>Pragmatic solutions that deliver value quickly without over-engineering</p>
                    </div>
                </div>
            </section>

            <!-- Services by Category -->
            {categoryOrder.map(category => servicesByCategory[category] && (
                <section class="category-section">
                    <h2 class="category-title">{category}</h2>
                    <Grid variant="offset">
                        {servicesByCategory[category].map((project) => (
                            <li>
                                <PortfolioPreview project={project} />
                            </li>
                        ))}
                    </Grid>
                </section>
            ))}
        </main>
        <ContactCTA />
    </div>
</BaseLayout>

<style>
    .service-overview {
        background: var(--gradient-subtle);
        border: 1px solid var(--gray-800);
        border-radius: 0.75rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .service-overview h2 {
        font-size: var(--text-2xl);
        color: var(--gray-0);
        margin-bottom: 1rem;
    }

    .service-overview > p {
        font-size: var(--text-lg);
        color: var(--gray-300);
        line-height: 1.6;
        margin-bottom: 2rem;
    }

    .value-props {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .value-prop {
        background: var(--gray-999);
        padding: 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid var(--gray-800);
    }

    .value-prop h3 {
        font-size: var(--text-lg);
        color: var(--gray-0);
        margin-bottom: 0.5rem;
    }

    .value-prop p {
        font-size: var(--text-base);
        color: var(--gray-300);
        margin: 0;
    }

    .category-section {
        margin-top: 3rem;
    }

    .category-title {
        font-size: var(--text-xl);
        color: var(--gray-0);
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--accent-regular);
    }

    @media (min-width: 50em) {
        .service-overview {
            padding: 3rem;
        }
    }
</style>
